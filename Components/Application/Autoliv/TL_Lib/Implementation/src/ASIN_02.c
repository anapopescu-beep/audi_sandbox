/**
 * @file       $RCSfile: ASIN_02.c $
 * @brief      This file contains function F__I16ASINI16 for calculation of arcsin.
 * @author     Dagmar Andoleit
 * @copyright  (c) 2016, dSPACE GmbH, Paderborn, Germany
 * @version    $Revision: 1.1 $ $Date: 2022/11/11 13:24:54CET $
 */

#include "dsfxp.h"

/******************************************************************************
*
* FUNCTION:
*   F__I16ASINI16(v)
*
* DESCRIPTION:
*   Calculates arcsin of 16 bit input using non equidistant lookup table.
*
* PARAMETERS:
*   Int16   v      input value
*
* RETURNS:
*   Int16   fcn    return value
*
******************************************************************************/
Int16 F__I16ASINI16(Int16 v)
{
	static const UInt16 y_table[128] =
	{
	0U,1279U,2079U,2743U,3334U,3875U,4379U,4855U,5307U,5740U,6155U,6556U,6943U,7319U,7685U,8039U,
	8384U,8723U,9051U,9373U,9689U,9998U,10300U,10598U,10890U,11177U,11459U,11735U,12007U,12274U,
	12537U,12796U,13053U,13303U,13550U,13794U,14034U,14272U,14505U,14734U,14960U,15184U,15404U,
	15622U,15834U,16046U,16254U,16459U,16662U,16862U,17058U,17254U,17446U,17636U,17823U,18006U,
	18188U,18366U,18542U,18716U,18889U,19058U,19227U,19392U,19553U,19715U,19870U,20026U,20180U,
	20329U,20479U,20624U,20769U,20912U,21052U,21189U,21326U,21459U,21589U,21719U,21844U,21970U,
	22094U,22214U,22334U,22447U,22564U,22676U,22785U,22893U,22999U,23104U,23206U,23305U,23402U,
	23502U,23593U,23687U,23777U,23862U,23952U,24037U,24116U,24189U,24276U,24345U,24418U,24495U,
	24563U,24635U,24696U,24761U,24813U,24887U,24947U,24990U,25035U,25109U,25136U,25193U,25224U,
	25293U,25331U,25374U,25422U,25480U,25555U,25736U
	};
	static const UInt16 x_table[128] =
	{
	0U,1278U,2073U,2730U,3311U,3839U,4327U,4784U,5215U,5623U,6011U,6382U,6737U,7078U,7406U,7720U,
	8023U,8317U,8598U,8870U,9134U,9389U,9635U,9874U,10106U,10330U,10547U,10757U,10961U,11158U,
	11349U,11534U,11715U,11889U,12057U,12221U,12380U,12534U,12683U,12827U,12966U,13102U,13233U,
	13360U,13482U,13601U,13716U,13827U,13935U,14039U,14139U,14237U,14331U,14422U,14510U,14594U,
	14676U,14754U,14830U,14903U,14974U,15042U,15108U,15171U,15231U,15290U,15345U,15399U,15451U,
	15500U,15548U,15593U,15637U,15679U,15719U,15757U,15794U,15829U,15862U,15894U,15924U,15953U,
	15981U,16007U,16032U,16055U,16078U,16099U,16119U,16138U,16156U,16173U,16189U,16204U,16218U,
	16232U,16244U,16256U,16267U,16277U,16287U,16296U,16304U,16311U,16319U,16325U,16331U,16337U,
	16342U,16347U,16351U,16355U,16358U,16362U,16365U,16367U,16369U,16372U,16373U,16375U,16376U,
	16378U,16379U,16380U,16381U,16382U,16383U,16384U
	};
    UInt16 y_Out;
    Int16 i = 0;
    UInt16 xi;
    Int8 sign = 1;
    Int16 r;

    if (v <= -16384) {r = -25736;}
    else if (v >= 16384) {r = 25736;}
    else
    {
    	if ( v < 0 )
    	{
            v = (Int16)-v;
            sign = -1;
    	}

    	while ((UInt16)v > x_table[i+1])
    	{
       	    i++;
    	}

    	xi = x_table[i];
    	xi = (UInt16)((UInt32)((UInt32)(v - xi) << 14U) / (UInt16)(x_table[i+1] - xi));

    	y_Out = y_table[i];
    	y_Out += (UInt16)((UInt32)((UInt32)(y_table[i+1] - y_Out) * xi) >> 14U);

    	r = ((Int16)y_Out * (Int16)sign);
    }
    return r;
}
/* END F__I16ASINI16() */
