/**************************************************************************************************\
 *** 
 *** Simulink model       : eCS_Algo_Simulation_2015b_opti
 *** TargetLink subsystem : eCS_Algo_Simulation_2015b_opti/FSM
 *** Codefile             : FSM.c
 ***
 *** Generated by TargetLink, the dSPACE production quality code generator
 *** Generation date: 2022-10-10 12:28:35
 ***
 *** CODE GENERATOR OPTIONS:
 *** Code generation mode                     : AUTOSAR
 *** AUTOSAR version                          : 4.2.2
 *** Compiler                                 : <unknown>
 *** Target                                   : Generic
 *** ANSI-C compatible code                   : yes
 *** Code Optimization                        : enabled
 *** Constant style                           : decimal
 *** Clean code option                        : enabled
 *** Logging mode                             : Do not log anything
 *** Code Coverage                            : disabled
 *** Generate empty conditional branches      : disabled
 *** Loop unroll threshold                    : 5
 *** Shift mode                               : automatic
 *** Handle unscaled SF expr. with TL type    : enabled
 *** Assignment of conditions                 : AllBooleanOutputs 
 *** Scope reduction only to function level   : disabled
 *** Exploit ranges if not erasable           : disabled
 *** Exploit Compute Through Overflow         : optimized
 *** Linker sections                          : enabled
 *** Enable Assembler                         : disabled
 *** Variable name length                     : 31 chars
 *** Use global bitfields                     : disabled
 *** Stateflow: use of bitfields              : enabled
 *** State activity encoding limit            : 5
 *** Omit zero inits in restart function      : disabled
 *** Share functions between TL subsystems    : disabled
 *** Generate 64bit functions                 : enabled
 *** Inlining Threshold                       : 6
 *** Line break limit                         : 100
 *** Target optimized boolean data type       : enabled
 *** Keep saturation elements                 : disabled
 *** Extended variable sharing                : disabled
 *** Extended lifetime optimization           : enabled
 *** Style definition file                    : C:\Program Files\dSPACE TargetLink 4.2\Matlab\Tl\Con
 ***                                            fig\codegen\cconfig.xml
 *** Root style sheet                         : C:\Program Files\dSPACE TargetLink 4.2\Matlab\Tl\XML
 ***                                            \CodeGen\Stylesheets\TL_CSourceCodeSS.xsl
 ***
 *** SUBSYS                   CORRESPONDING SIMULINK SUBSYSTEM
 *** Sb1                      FSM
 *** Sb2                      FSM/FSM
 *** Sb3                      FSM/FSM/FSM_runCheckVehicleInputs
 *** Sb4                      FSM/FSM/FSM_runMainFunction
 *** Sb5                      FSM/FSM/FSM_runCheckVehicleInputs/For IteratorSubsystem
 *** Sb6                      FSM/FSM/FSM_runCheckVehicleInputs/For IteratorSubsystem/FSM_runCheckMo
 ***                          deStatus
 *** Sb7                      FSM/FSM/FSM_runMainFunction/Determine Transition
 *** Sb8                      FSM/FSM/FSM_runMainFunction/ExecuteState
 *** Sb9                      FSM/FSM/FSM_runMainFunction/ExecuteState/State Default
 *** Sb10                     FSM/FSM/FSM_runMainFunction/ExecuteState/State Disabled
 *** Sb11                     FSM/FSM/FSM_runMainFunction/ExecuteState/State Lock
 *** Sb12                     FSM/FSM/FSM_runMainFunction/ExecuteState/State Unlock
 *** 
 *** SUBSYS                   CORRESPONDING MODEL BLOCK (REFERENCED MODEL)
 *** 
 *** SF-NODE   CORRESPONDING STATEFLOW NODE                           DESCRIPTION
 *** 
 *** TargetLink version      : 4.2 from 14-Oct-2016
 *** Code generator version  : Build Id 4.2.0.26 from 2016-10-17 16:31:48

\**************************************************************************************************/

#ifndef FSM_C
#define FSM_C

/*----------------------------------------------------------------------------*\
  DEFINES (OPT)
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  INCLUDES
\*----------------------------------------------------------------------------*/

#include "Rte_FSM.h"
#include "FSM_ARfrm.h"
#include "FSM.h"
#include "Common.h"

/*----------------------------------------------------------------------------*\
  ENUMS
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  DEFINES
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  TYPEDEFS
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  VARIABLES
\*----------------------------------------------------------------------------*/

/******************************************************************************\
   GLOBAL: global variables (RAM) | Width: 8
\******************************************************************************/
GLOBAL uint8 fsm_au32SolenoidInhibMask[6] = 
{
   /* [0..5] */ 1, 2, 3, 4, 5, 6
   /* 1., 2., 3., 4., 5., 6. */
};

/*----------------------------------------------------------------------------*\
  PARAMETERIZED MACROS
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  FUNCTION PROTOTYPES
\*----------------------------------------------------------------------------*/

/******************************************************************************\
   EXTERN_FCN: external function(s) (imported from another module)
\******************************************************************************/
extern void FSM_runCheckModeStatus(uint32 Sb6_u32ModesToCheck, uint8 * FSM_b8_ModeStatusResult);

/*----------------------------------------------------------------------------*\
  INLINE FUNCTIONS
\*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*\
  FUNCTION DEFINITIONS
\*----------------------------------------------------------------------------*/

/**************************************************************************************************\
 ***  FUNCTION:
 ***      FSM
 *** 
 ***  DESCRIPTION:
 ***      
 *** 
 ***  PARAMETERS:
 ***      Type               Name                Description
 ***      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***
 ***  RETURNS:
 ***      void
 ***
 ***  SETTINGS:
 ***
\**************************************************************************************************/
void FSM(void)
{
   /* SLStaticLocalInit: Default storage class for static local variables with initvalue | Width: 8
    */
   static uint8 Ctr_Sb4 = 1;

   /* call of function: FSM/FSM/FSM_runCheckVehicleInputs */
   Task_FSM_runCh__eInputs_Wrapper();
   if ((--Ctr_Sb4) == 0) {
      /* call of function: FSM/FSM/FSM_runMainFunction */
      Task_FSM_runMa__unction_Wrapper();
      Ctr_Sb4 = 40;
   }
}

/**************************************************************************************************\
 ***  FUNCTION:
 ***      FSM_runCheckVehicleInputs
 *** 
 ***  DESCRIPTION:
 ***      
 *** 
 ***  PARAMETERS:
 ***      Type               Name                Description
 ***      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***
 ***  RETURNS:
 ***      void
 ***
 ***  SETTINGS:
 ***
\**************************************************************************************************/
#define FSM_START_SEC_CODE
#include "FSM_MemMap.h"

FUNC(void, FSM_CODE) FSM_runCheckVehicleInputs(void)
{
   /* SLLocal: Default storage class for local variables | Width: 8 */
   uint8 FSM_b8_ModeStatusResult;
   sint8 Sb5_For_Iterator_it;

   /* SLLocalInit: Default storage class for local variables with init value | Width: 8 */
   uint8 au8SolenoidEnable[6];

   for (Sb5_For_Iterator_it = 0; Sb5_For_Iterator_it <= 5; Sb5_For_Iterator_it++)
   {
      /* call of function: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator
         Subsystem/FSM_runCheckModeStatus
         
         # combined # update(s) for inport FSM/FSM/FSM_runCheckVehicleInputs/For Iterator
         Subsystem/FSM_runCheckModeStatus
         /u32ModesToCheck
         # combined # Selector: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/Solenoid_Se
         lector */
      FSM_runCheckModeStatus((uint32) fsm_au32SolenoidInhibMask[Sb5_For_Iterator_it],
       &FSM_b8_ModeStatusResult);

      /* Switch: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/IFfor Solenoid
         FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/IFfor Solenoid: Omitted comparison
          with constant.
         # combined # Relational: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/Relationa
         l Operator1
         # combined # FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/(uint8_2)
         # combined # FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/(uint8) */
      if (B_TRUE == FSM_b8_ModeStatusResult) {
         /* Switch: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/IFfor Solenoid
            # combined # Assignment: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/Assign
             the enable  state of solenoids - output calculation */
         au8SolenoidEnable[Sb5_For_Iterator_it] = KU8_ONE;
      }
      else {
         /* Switch: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/IFfor Solenoid
            # combined # Assignment: FSM/FSM/FSM_runCheckVehicleInputs/For Iterator Subsystem/Assign
             the enable  state of solenoids - output calculation */
         au8SolenoidEnable[Sb5_For_Iterator_it] = KU8_ZERO;
      }
   }

   /* TargetLink outport: FSM/FSM/FSM_runCheckVehicleInputs/au8SolenoidEnable
      # combined # TargetLink outport: FSM/FSM/FSM_runCheckVehicleInputs/au8SolenoidEnable */
   Rte_IrvWrite_FSM_runCheckVehicleInputs_au8IsSolenoidUsed((const uint8 *) au8SolenoidEnable);
}

#define FSM_STOP_SEC_CODE
#include "FSM_MemMap.h"

/**************************************************************************************************\
 ***  FUNCTION:
 ***      FSM_runMainFunction
 *** 
 ***  DESCRIPTION:
 ***      
 *** 
 ***  PARAMETERS:
 ***      Type               Name                Description
 ***      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 ***
 ***  RETURNS:
 ***      void
 ***
 ***  SETTINGS:
 ***
\**************************************************************************************************/
#define FSM_START_SEC_CODE
#include "FSM_MemMap.h"

FUNC(void, FSM_CODE) FSM_runMainFunction(void)
{
   /* SLLocal: Default storage class for local variables | Width: 8 */
   sint8 Sb7_For_Iterator_it;
   uint8 au8IsSolenoidUsed[6];
   b8EcsTriggerType b8EcsFlag;

   /* SLLocalInit: Default storage class for local variables with init value | Width: 8 */
   uint8 au8FsmSelectedProfiles[6];
   uint8 au8SolenoidStates[6];

   /* TargetLink inport: FSM/FSM/FSM_runMainFunction/au8SolenoidEnable */
   Rte_IrvRead_FSM_runMainFunction_au8IsSolenoidUsed(au8IsSolenoidUsed);

   /* TargetLink inport: FSM/FSM/FSM_runMainFunction/drparg_b8EcsFlag */
   Rte_Read_prrEcsAlgoFlag_b8EcsFlag(&b8EcsFlag);
   for (Sb7_For_Iterator_it = 0; Sb7_For_Iterator_it <= 5; Sb7_For_Iterator_it++)
   {
      /* Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/HoldAndUnlock
         # combined # Selector: FSM/FSM/FSM_runMainFunction/Determine Transition/SolenoidSelector */
      if (au8IsSolenoidUsed[Sb7_For_Iterator_it] != 0) {
         /* Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/HoldAndUnlock
            # combined # Assignment: FSM/FSM/FSM_runMainFunction/Determine Transition/Assign the sta
            te of solenoids - output calculation */
         au8SolenoidStates[Sb7_For_Iterator_it] = KU8_DISABLED_STATE;
      }
      else {
         /* Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/Switch */
         if (b8EcsFlag != 0) {
            /* Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/Switch
               # combined # Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/HoldAndUnlock
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/Determine Transition/Assign the 
               state of solenoids - output calculation */
            au8SolenoidStates[Sb7_For_Iterator_it] = KU8_LOCK_STATE;
         }
         else {
            /* Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/Switch
               # combined # Switch: FSM/FSM/FSM_runMainFunction/Determine Transition/HoldAndUnlock
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/Determine Transition/Assign the 
               state of solenoids - output calculation */
            au8SolenoidStates[Sb7_For_Iterator_it] = KU8_UNLOCK_STATE;
         }
      }

      /* SwitchCase: FSM/FSM/FSM_runMainFunction/ExecuteState/Switch Case
         # combined # Selector: FSM/FSM/FSM_runMainFunction/ExecuteState/Solenoid Selector */
      switch (au8SolenoidStates[Sb7_For_Iterator_it]) {
         case 0: {
            /* Reference of merge block: Merge FSM/FSM/FSM_runMainFunction/ExecuteState/Merge
               update of variable(s) associated with FSM/FSM/FSM_runMainFunction/ExecuteState/State 
               Lock
               /Constant1
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/ExecuteState/Assign the Fsm prof
               ile of solenoids - output calculation */
            au8FsmSelectedProfiles[Sb7_For_Iterator_it] = KU8_PROFILE_NONE;
            break;
         }
         case 1: {
            /* Reference of merge block: Merge FSM/FSM/FSM_runMainFunction/ExecuteState/Merge
               update of variable(s) associated with FSM/FSM/FSM_runMainFunction/ExecuteState/State 
               Unlock/Constant2
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/ExecuteState/Assign the Fsm prof
               ile of solenoids - output calculation */
            au8FsmSelectedProfiles[Sb7_For_Iterator_it] = KU8_PROFILE_UNLOCK;
            break;
         }
         case 2: {
            /* Reference of merge block: Merge FSM/FSM/FSM_runMainFunction/ExecuteState/Merge
               update of variable(s) associated with FSM/FSM/FSM_runMainFunction/ExecuteState/State 
               Disabled/Constant1
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/ExecuteState/Assign the Fsm prof
               ile of solenoids - output calculation */
            au8FsmSelectedProfiles[Sb7_For_Iterator_it] = KU8_PROFILE_NONE;
            break;
         }
         default: {
            /* Reference of merge block: Merge FSM/FSM/FSM_runMainFunction/ExecuteState/Merge
               update of variable(s) associated with FSM/FSM/FSM_runMainFunction/ExecuteState/State 
               Default/Constant1
               # combined # Assignment: FSM/FSM/FSM_runMainFunction/ExecuteState/Assign the Fsm prof
               ile of solenoids - output calculation */
            au8FsmSelectedProfiles[Sb7_For_Iterator_it] = KU8_PROFILE_NONE;
            break;
         }
      }
   }

   /* # combined # TargetLink outport: FSM/FSM/FSM_runMainFunction/au8SelectedProfile */
   Rte_Write_psrSolenoidProfile_au8SelectedProfile((const uint8 *) au8FsmSelectedProfiles);

   /* # combined # TargetLink outport: FSM/FSM/FSM_runMainFunction/au8FsmState */
   Rte_Write_psrSolenoidState_au8SolenoidState((const uint8 *) au8SolenoidStates);
}

#define FSM_STOP_SEC_CODE
#include "FSM_MemMap.h"

/*----------------------------------------------------------------------------*\
  MODULE LOCAL FUNCTION DEFINITIONS
\*----------------------------------------------------------------------------*/
#endif /* FSM_C */
/*----------------------------------------------------------------------------*\
  END OF FILE
\*----------------------------------------------------------------------------*/
